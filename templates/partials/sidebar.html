<!-- Left Sidebar -->
<div class="w-full md:w-80 bg-base-100 border-r border-base-300 flex flex-col"
    :class="{ 'hidden md:flex': !showSidebar, 'flex': showSidebar }">
    <div class="p-4 border-b border-base-300">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-lg font-bold">Configurations</h2>
            <div class="flex gap-2">
                <button x-show="selectedIndices.length > 0" @click="deleteSelectedConfigs()"
                    class="btn btn-error btn-sm btn-circle" title="Delete Selected">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
                <button @click="addNewConfig()" class="btn btn-success btn-sm btn-circle" title="Add New">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
            </div>
        </div>
        <input type="text" placeholder="Search..." class="input input-bordered input-sm w-full" x-model="searchQuery" />
        <div class="flex justify-between items-center mt-2">
            <div class="flex items-center gap-2">
                <input type="checkbox" class="checkbox checkbox-primary checkbox-xs" :checked="isAllSelected"
                    @change="toggleSelectAll()" />
                <span class="text-[10px] opacity-60 font-medium uppercase tracking-wider">Select All</span>
            </div>
            <div class="text-xs opacity-60" x-text="`${filteredConfigs.length} configs`"></div>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto">
        <ul class="menu menu-xs w-full p-2 gap-1">
            <template x-for="group in groupedConfigs" :key="group.path">
                <li>
                    <details :open="searchQuery.length > 0 || true">
                        <summary
                            class="group/summary py-2 px-3 hover:bg-base-200/50 rounded-lg text-base-content/70 font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-4 h-4 text-warning opacity-70">
                                <path fill-rule="evenodd"
                                    d="M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H8a3 3 0 00-3 3v1.5a1.5 1.5 0 01-1.5 1.5H2a2 2 0 01-2-2V6zm4.655 4.5a1.5 1.5 0 00-2.25-1.5H2.25c-.141 0-.277.02-.407.058a4 4 0 014.156-2.61c.446.049.866.216 1.223.465.326.228.604.516.829.851.274.408.388.904.321 1.402a1.503 1.503 0 00.347.114l-.063.12z"
                                    clip-rule="evenodd" />
                                <path
                                    d="M8 12.5a1.5 1.5 0 00-1.5-1.5h-.105a3.003 3.003 0 012.215-2.68 3.002 3.002 0 10-3.35 4.634 1.5 1.5 0 001.24 1.046h5a1.5 1.5 0 001.5-1.5V12.5z" />
                                <path d="M12.25 10a1.5 1.5 0 00-1.5 1.5V14h5.75a1.5 1.5 0 001.5-1.5v-1h-5.75z" />
                                <path fill-rule="evenodd"
                                    d="M2.25 15.5a1.5 1.5 0 001.5 1.5h12.5a1.5 1.5 0 001.5-1.5v-1a.5.5 0 00-.5-.5H3.75a.5.5 0 00-.5.5v1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span x-text="group.path" class="truncate opacity-80" :title="group.path"></span>
                            <span class="text-[10px] opacity-40 ml-auto font-normal"
                                x-text="group.configs.length"></span>
                        </summary>
                        <ul>
                            <template x-for="cfg in group.configs" :key="cfg.originalIndex">
                                <li class="relative">
                                    <div class="group/item pr-2 flex items-center">
                                        <div class="pl-2">
                                            <input type="checkbox" class="checkbox checkbox-primary checkbox-xs"
                                                :checked="selectedIndices.includes(cfg.originalIndex)"
                                                @change="toggleSelection(cfg.originalIndex)" />
                                        </div>
                                        <a @click="selectConfig(cfg.originalIndex)"
                                            :class="{ 'active': selectedIndex === cfg.originalIndex }"
                                            class="flex-1 flex items-center gap-2 py-2 pl-2 pr-10 rounded-md hover:bg-base-200 transition-colors w-full cursor-pointer relative z-0">

                                            <div :class="{
                                                'badge-info': cfg.method === 'GET',
                                                'badge-success': cfg.method === 'POST',
                                                'badge-warning': cfg.method === 'PUT',
                                                'badge-error': cfg.method === 'DELETE'
                                            }"
                                                class="badge badge-xs font-mono font-bold shrink-0 h-5 w-12 border-none text-white">
                                                <span x-text="cfg.method" class="text-[9px]"></span>
                                            </div>

                                            <span class="truncate text-xs font-medium flex-1 min-w-0 block"
                                                x-text="cfg.name.length > 30 ? cfg.name.substring(0, 20) + '...' : cfg.name"
                                                :title="cfg.name"></span>
                                        </a>

                                        <!-- Duplicate Button - Always Rendered but Hidden -->
                                        <button type="button" @click.stop="duplicateConfig(cfg.originalIndex)"
                                            class="absolute right-2 top-1/2 -translate-y-1/2 btn btn-xs btn-square btn-ghost opacity-0 group-hover/item:opacity-100 transition-opacity z-10 bg-base-100/80 backdrop-blur-sm border border-base-200 hover:bg-primary hover:text-white hover:border-primary shadow-sm"
                                            title="Duplicate">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                            </svg>
                                        </button>
                                    </div>
                                </li>
                            </template>
                        </ul>
                    </details>
                </li>
            </template>
        </ul>

        <!-- Footer to indicate end of list -->
        <div class="p-4 border-t border-base-300 bg-base-200/50 text-center">
            <div class="text-xs opacity-60">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mb-1" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span x-text="`End of list â€¢ ${filteredConfigs.length} total`"></span>
            </div>
        </div>
    </div>
</div>