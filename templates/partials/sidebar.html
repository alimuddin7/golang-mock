<!-- Left Sidebar -->
<div class="fixed md:relative inset-y-0 left-0 w-80 bg-base-100 border-r-4 border-base-content flex flex-col transition-all duration-300 z-[90] h-full"
    :class="{ '-translate-x-full md:translate-x-0': !showSidebar, 'translate-x-0': showSidebar }">
    <div class="p-5 border-b-2 border-base-content/10 bg-base-200/50">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xs font-medium uppercase tracking-[0.2em] text-base-content">Configurations</h2>
            <div class="flex gap-2">
                <button x-show="selectedIndices.length > 0" @click="deleteSelectedConfigs()"
                    class="btn btn-error btn-xs btn-square border-2 border-base-content transition-all"
                    title="Delete Selected">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
                <button @click="addNewConfig()"
                    class="btn btn-primary btn-xs btn-square border-2 border-base-content transition-all"
                    title="Add New Configuration">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="relative group">
            <div
                class="absolute inset-y-0 left-3 flex items-center pointer-events-none opacity-40 group-focus-within:opacity-100 transition-opacity">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
            <input type="text" placeholder="Search Mocks..."
                class="input input-sm bg-base-100 border-2 border-base-content w-full pl-9 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-primary/20"
                x-model="searchQuery" />
        </div>
        <div class="flex justify-between items-center mt-3">
            <label class="flex items-center gap-2 cursor-pointer group">
                <input type="checkbox"
                    class="checkbox checkbox-primary checkbox-xs rounded border-2 border-base-content"
                    :checked="isAllSelected" @change="toggleSelectAll()" />
                <span class="text-[9px] font-medium uppercase tracking-widest opacity-60">Select All</span>
            </label>
            <div class="badge badge-neutral badge-xs py-2 px-2 font-medium border-2 border-base-content"
                x-text="`${filteredConfigs.length}`">
            </div>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto custom-scrollbar">
        <ul class="menu menu-sm w-full p-3 pb-24 gap-2">
            <template x-for="group in groupedConfigs" :key="group.path">
                <li class="mb-1">
                    <details :open="searchQuery.length > 0 || true" class="group/details">
                        <summary
                            class="py-2 px-3 hover:bg-base-200 rounded-lg text-base-content/80 font-medium transition-all group-open/details:text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-4 h-4 opacity-50 transition-transform group-open/details:rotate-90">
                                <path fill-rule="evenodd"
                                    d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span x-text="group.path" class="truncate flex-1 ml-1" :title="group.path"></span>
                            <span class="badge badge-ghost badge-xs font-medium" x-text="group.configs.length"></span>
                        </summary>
                        <ul class="mt-1 ml-2 border-l-2 border-base-content/10 pl-2 space-y-1.5">
                            <template x-for="cfg in group.configs" :key="cfg.originalIndex">
                                <li class="relative group/item">
                                    <div class="p-0 flex items-center rounded-lg overflow-hidden border-2 border-transparent transition-all"
                                        :class="{ 'bg-primary/10 border-base-content': selectedIndex === cfg.originalIndex, 'hover:bg-base-200 hover:border-base-content/10': selectedIndex !== cfg.originalIndex }">
                                        <div class="pl-3 pr-1">
                                            <input type="checkbox"
                                                class="checkbox checkbox-primary checkbox-xs rounded border-2 border-base-content"
                                                :checked="selectedIndices.includes(cfg.originalIndex)"
                                                @change="toggleSelection(cfg.originalIndex)" />
                                        </div>
                                        <a @click="selectConfig(cfg.originalIndex)"
                                            class="flex-1 flex items-center gap-3 py-2 pl-2 pr-10 cursor-pointer overflow-hidden">

                                            <div :class="{
                                                'bg-info text-info-content': cfg.method === 'GET',
                                                'bg-success text-success-content': cfg.method === 'POST',
                                                'bg-warning text-warning-content': cfg.method === 'PUT',
                                                'bg-error text-error-content': cfg.method === 'DELETE'
                                            }"
                                                class="px-1.5 py-0.5 rounded-sm font-medium font-mono text-[9px] min-w-[36px] text-center uppercase border border-base-content/20">
                                                <span x-text="cfg.method"></span>
                                            </div>

                                            <span class="truncate text-xs font-medium flex-1 min-w-0" x-text="cfg.name"
                                                :class="{ 'text-primary': selectedIndex === cfg.originalIndex }"
                                                :title="cfg.name"></span>
                                        </a>

                                        <button type="button" @click.stop="duplicateConfig(cfg.originalIndex)"
                                            class="absolute right-2 btn btn-xs btn-square btn-ghost opacity-0 group-hover/item:opacity-100 transition-opacity z-10 hover:bg-primary hover:text-primary-content rounded-md border border-base-content/20"
                                            title="Duplicate">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                            </svg>
                                        </button>
                                    </div>
                                </li>
                            </template>
                        </ul>
                    </details>
                </li>
            </template>
        </ul>

        <!-- Footer to indicate end of list -->
        <div class="px-5 pb-16 opacity-40 text-center select-none">
            <div class="flex flex-col items-center gap-2">
                <div class="h-[2px] w-12 bg-base-content"></div>
                <span class="text-[9px] font-medium uppercase tracking-[0.2em]">End of Archive</span>
                <div class="h-[2px] w-12 bg-base-content"></div>
            </div>
        </div>
    </div>
</div>