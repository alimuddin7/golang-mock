<div class="h-full flex flex-col p-4 md:p-6" x-data="{ activeTab: 'response' }">
    <!-- Editor Card -->
    <div
        class="flex-1 flex flex-col bg-base-100 rounded-3xl border border-base-200 shadow-sm overflow-hidden min-h-0 relative">
        <!-- Empty State -->
        <template x-if="!selectedConfig">
            <div class="flex-1 flex flex-col items-center justify-center p-12 text-center animation-fade-in h-full">
                <div class="relative mb-10">
                    <div
                        class="absolute inset-0 bg-primary/20 blur-3xl rounded-full scale-150 transform -translate-y-4">
                    </div>
                    <div
                        class="w-32 h-32 bg-primary/5 rounded-[3rem] flex items-center justify-center border border-primary/10 relative z-10">
                        <i class="ri-code-s-slash-line text-6xl text-primary opacity-20"></i>
                    </div>
                </div>
                <h3 class="text-3xl font-bold tracking-tight opacity-10 mb-3 italic">GopherMock</h3>
                <p class="text-xs font-bold uppercase tracking-[0.3em] opacity-40 max-w-xs leading-relaxed">Select or
                    initialize a configuration <br />to access the workbench</p>
            </div>
        </template>

        <!-- Editor Content -->
        <template x-if="selectedConfig">
            <div class="flex-1 flex flex-col min-h-0 animation-fade-in overflow-hidden">
                <!-- Header -->
                <div
                    class="h-20 shrink-0 border-b border-base-200 bg-base-100 px-6 md:px-8 flex items-center justify-between z-10">
                    <div class="flex items-center gap-6 flex-1 min-w-0">
                        <div class="relative group/method">
                            <select x-model="configs[selectedIndex].method" :class="{
                                    'bg-info/10 text-info border-info/20 focus:ring-info/10': configs[selectedIndex].method === 'GET',
                                    'bg-success/10 text-success border-success/20 focus:ring-success/10': configs[selectedIndex].method === 'POST',
                                    'bg-warning/10 text-warning border-warning/20 focus:ring-warning/10': configs[selectedIndex].method === 'PUT',
                                    'bg-error/10 text-error border-error/20 focus:ring-error/10': configs[selectedIndex].method === 'DELETE',
                                    'bg-secondary/10 text-secondary border-secondary/20 focus:ring-secondary/10': !['GET', 'POST', 'PUT', 'DELETE'].includes(configs[selectedIndex].method)
                                }"
                                class="appearance-none select select-sm h-11 rounded-xl font-bold font-mono text-xs border uppercase pr-10 focus:outline-none focus:ring-4 transition-all cursor-pointer">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                                <option value="OPTIONS">OPTIONS</option>
                                <option value="HEAD">HEAD</option>
                            </select>
                            <i
                                class="ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none opacity-60 text-xs"></i>
                        </div>
                        <div class="flex flex-col flex-1 min-w-0">
                            <div class="relative group/name flex items-center gap-3">
                                <input type="text" x-model="configs[selectedIndex].name"
                                    class="text-xl font-bold tracking-tight bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-primary/10 rounded-xl flex-1 p-1 -ml-1 transition-all"
                                    placeholder="Untitled Mock" />
                            </div>
                            <div class="flex items-center gap-2">
                                <div
                                    class="flex items-center gap-2 bg-base-200/50 px-2 py-1 rounded-lg border border-base-200 font-mono text-[10px] font-bold group/path transition-all focus-within:border-primary/30">
                                    <span class="opacity-60 select-none text-[8px] text-base-content">PATH:</span>
                                    <input type="text" x-model="configs[selectedIndex].path"
                                        class="bg-transparent border-none focus:outline-none p-0 h-auto w-48 text-base-content/80"
                                        placeholder="/api/example" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <button @click="deleteCurrentConfig()"
                        class="btn btn-error btn-ghost btn-sm rounded-xl gap-2 font-bold uppercase tracking-wider px-4 transition-all hover:bg-error/10">
                        <i class="ri-delete-bin-7-line text-sm"></i>
                        <span class="hidden md:inline">Delete</span>
                    </button>
                </div>

                <!-- Scrollable Body -->
                <div class="flex-1 overflow-y-auto custom-scrollbar p-6 md:p-8">
                    <div class="max-w-5xl mx-auto space-y-10">
                        <!-- Navigation Tabs -->
                        <div
                            class="tabs tabs-boxed bg-base-200/50 p-1 rounded-xl border border-base-200 inline-flex shadow-sm">
                            <a class="tab tab-sm font-bold uppercase tracking-wider text-[10px] rounded-lg transition-all px-8 h-9"
                                :class="activeTab === 'response' ? 'tab-active bg-base-100 text-primary shadow-sm' : ''"
                                @click="activeTab = 'response'">Standard Response</a>
                            <a class="tab tab-sm font-bold uppercase tracking-wider text-[10px] rounded-lg transition-all px-8 h-9"
                                :class="activeTab === 'rules' ? 'tab-active bg-base-100 text-primary shadow-sm' : ''"
                                @click="activeTab = 'rules'">Conditional Logic</a>
                        </div>

                        <!-- Standard Response Section -->
                        <div x-show="activeTab === 'response'" class="space-y-10 animation-fade-in">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="space-y-6">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="form-control">
                                            <label class="label pt-0"><span
                                                    class="label-text text-[9px] font-bold uppercase tracking-widest opacity-70 text-base-content">Status
                                                    Code</span></label>
                                            <input type="number" x-model="selectedConfig.statusCode"
                                                class="input input-sm border border-base-300 bg-base-200/30 rounded-xl font-bold h-11" />
                                        </div>
                                        <div class="form-control">
                                            <label class="label pt-0"><span
                                                    class="label-text text-[9px] font-bold uppercase tracking-widest opacity-70 text-base-content">Delay
                                                    (ms)</span></label>
                                            <input type="number" x-model="selectedConfig.timeout"
                                                class="input input-sm border border-base-300 bg-base-200/30 rounded-xl font-bold h-11" />
                                        </div>
                                    </div>
                                    <div class="form-control group/json relative">
                                        <label class="label pt-0"><span
                                                class="label-text text-[9px] font-bold uppercase tracking-widest opacity-70 text-base-content">Response
                                                Headers</span></label>
                                        <div class="relative group/prettify">
                                            <textarea x-model="selectedConfig.responseHeaders"
                                                class="textarea border border-base-300 bg-base-200/30 font-mono text-[10px] h-32 w-full rounded-xl resize-none p-4 focus:border-primary/30"></textarea>
                                            <button @click="beautifyJSON('responseHeaders')"
                                                class="absolute top-2 right-2 btn btn-xs btn-ghost gap-1 opacity-0 group-hover/prettify:opacity-100 transition-opacity bg-base-100/80 backdrop-blur-sm border border-base-200 font-bold text-[9px]">
                                                <i class="ri-magic-line"></i> PRETTIFY
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-control group/json relative">
                                    <label class="label pt-0"><span
                                            class="label-text text-[9px] font-bold uppercase tracking-widest opacity-70 text-base-content">Response
                                            Body</span></label>
                                    <div class="relative group/prettify h-full">
                                        <textarea x-model="selectedConfig.responseBody"
                                            class="textarea border border-base-300 bg-base-200/30 font-mono text-[10px] h-full w-full rounded-xl resize-none p-4 min-h-[300px] focus:border-primary/30"></textarea>
                                        <button @click="beautifyJSON('responseBody')"
                                            class="absolute top-2 right-2 btn btn-xs btn-ghost gap-1 opacity-0 group-hover/prettify:opacity-100 transition-opacity bg-base-100/80 backdrop-blur-sm border border-base-200 font-bold text-[9px]">
                                            <i class="ri-magic-line"></i> PRETTIFY
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Optional Request Validation Restored -->
                            <div
                                class="collapse collapse-plus bg-base-200/30 rounded-2xl border border-base-200 overflow-hidden">
                                <input type="checkbox" />
                                <div
                                    class="collapse-title text-[10px] font-bold uppercase tracking-widest opacity-50 flex items-center h-12">
                                    Optional Request Validation
                                </div>
                                <div class="collapse-content space-y-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-2">
                                        <div class="form-control group/json relative">
                                            <label class="label p-0 mb-2"><span
                                                    class="label-text text-[9px] font-bold uppercase tracking-widest opacity-70 text-base-content">Required
                                                    Req. Headers</span></label>
                                            <div class="relative group/prettify">
                                                <textarea x-model="selectedConfig.requestHeaders"
                                                    class="textarea border border-base-300 bg-base-100 font-mono text-[10px] h-24 w-full rounded-xl resize-none p-3 focus:border-primary/30"></textarea>
                                                <button @click="beautifyJSON('requestHeaders')"
                                                    class="absolute top-2 right-2 btn btn-xs btn-ghost gap-1 opacity-0 group-hover/prettify:opacity-100 transition-opacity bg-base-100/80 backdrop-blur-sm border border-base-200 font-bold text-[9px]">
                                                    <i class="ri-magic-line"></i> PRETTIFY
                                                </button>
                                            </div>
                                        </div>
                                        <div class="form-control group/json relative">
                                            <label class="label p-0 mb-2"><span
                                                    class="label-text text-[9px] font-bold uppercase tracking-widest opacity-70 text-base-content">Required
                                                    Req. Body</span></label>
                                            <div class="relative group/prettify">
                                                <textarea x-model="selectedConfig.requestBody"
                                                    class="textarea border border-base-300 bg-base-100 font-mono text-[10px] h-24 w-full rounded-xl resize-none p-3 focus:border-primary/30"></textarea>
                                                <button @click="beautifyJSON('requestBody')"
                                                    class="absolute top-2 right-2 btn btn-xs btn-ghost gap-1 opacity-0 group-hover/prettify:opacity-100 transition-opacity bg-base-100/80 backdrop-blur-sm border border-base-200 font-bold text-[9px]">
                                                    <i class="ri-magic-line"></i> PRETTIFY
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conditional Rules Section Restored -->
                        <div x-show="activeTab === 'rules'" class="space-y-6 animation-fade-in">
                            <div class="flex items-center justify-between mb-2">
                                <h3
                                    class="text-[10px] font-bold uppercase tracking-widest opacity-60 text-base-content">
                                    Logic Clauses</h3>
                                <button @click="addConditionalResponse()"
                                    class="btn btn-primary btn-xs rounded-lg gap-2 px-4 h-8">
                                    <i class="ri-add-line text-sm"></i>
                                    <span>New Rule</span>
                                </button>
                            </div>

                            <div class="space-y-8">
                                <template x-for="(resp, idx) in selectedConfig.responses || []" :key="idx">
                                    <div
                                        class="bg-base-100 rounded-2xl border border-base-200 overflow-hidden shadow-sm hover:shadow-md transition-all group/card">
                                        <div
                                            class="p-4 md:p-5 border-b border-base-200 flex flex-col md:flex-row items-start md:items-center justify-between bg-base-200/20 gap-4">
                                            <div class="flex flex-col md:flex-row items-center gap-6 flex-1 w-full">
                                                <div class="flex flex-col gap-1 w-full md:max-w-xs">
                                                    <label
                                                        class="text-[9px] font-bold uppercase tracking-widest opacity-50 px-1 text-base-content">Rule
                                                        Name</label>
                                                    <input type="text" x-model="resp.name"
                                                        class="input input-sm border border-base-300 bg-base-100 rounded-lg font-bold w-full" />
                                                </div>
                                                <div class="flex flex-col gap-1 w-full md:w-auto">
                                                    <label
                                                        class="text-[9px] font-bold uppercase tracking-widest opacity-50 px-1 text-base-content">Condition</label>
                                                    <select x-model="resp.ruleOperator"
                                                        class="select select-sm select-bordered border border-base-300 bg-base-100 rounded-lg font-bold h-8 min-h-0 text-[10px]">
                                                        <option value="AND">ALL (AND)</option>
                                                        <option value="OR">ANY (OR)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <button @click="deleteConditionalResponse(idx)"
                                                class="btn btn-ghost btn-xs btn-square text-error/60 hover:bg-error/10">
                                                <i class="ri-delete-bin-7-line text-sm"></i>
                                            </button>
                                        </div>

                                        <div class="p-6 space-y-8">
                                            <div class="space-y-4">
                                                <div class="flex items-center justify-between">
                                                    <label
                                                        class="text-[10px] font-bold uppercase tracking-widest text-primary">Matching
                                                        Clauses</label>
                                                    <button @click="addRule(idx)"
                                                        class="btn btn-xs btn-ghost gap-1 hover:bg-primary/5 text-primary">
                                                        <i class="ri-add-line"></i> Add Clause
                                                    </button>
                                                </div>
                                                <div class="space-y-2">
                                                    <template x-for="(rule, ridx) in resp.rules || []" :key="ridx">
                                                        <div
                                                            class="flex items-center gap-2 bg-base-200/30 p-2 rounded-xl border border-base-200 group/rule">
                                                            <select x-model="rule.target"
                                                                class="select select-xs border border-base-300 bg-base-100 font-bold text-[10px] h-9">
                                                                <option value="body">JSON Body</option>
                                                                <option value="header">Header</option>
                                                                <option value="query">Query Param</option>
                                                            </select>
                                                            <input type="text" x-model="rule.field"
                                                                placeholder="Field Path"
                                                                class="input input-xs border border-base-300 bg-base-100 font-mono text-xs w-full h-9" />
                                                            <select x-model="rule.operator"
                                                                class="select select-xs border border-base-300 bg-base-100 font-bold text-[10px] h-9">
                                                                <option value="equals">==</option>
                                                                <option value="not_equals">!=</option>
                                                                <option value="contains">CONTAINS</option>
                                                                <option value="regex">REGEX</option>
                                                            </select>
                                                            <input type="text" x-model="rule.value" placeholder="Value"
                                                                class="input input-xs border border-base-300 bg-base-100 font-mono text-xs w-full h-9" />
                                                            <button @click="deleteRule(idx, ridx)"
                                                                class="btn btn-ghost btn-xs text-error opacity-40 group-hover/rule:opacity-100">
                                                                <i class="ri-close-line"></i>
                                                            </button>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>

                                            <div
                                                class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-6 border-t border-base-200">
                                                <div class="space-y-5">
                                                    <div class="grid grid-cols-2 gap-4">
                                                        <div class="form-control">
                                                            <label class="label p-0 mb-1"><span
                                                                    class="text-[9px] font-bold uppercase tracking-widest opacity-60 text-base-content">Status
                                                                    Code</span></label>
                                                            <input type="number" x-model="resp.response.statusCode"
                                                                class="input input-sm border border-base-300 bg-base-100 rounded-lg font-bold" />
                                                        </div>
                                                        <div class="form-control">
                                                            <label class="label p-0 mb-1"><span
                                                                    class="text-[9px] font-bold uppercase tracking-widest opacity-60 text-base-content">Delay
                                                                    (ms)</span></label>
                                                            <input type="number" x-model="resp.response.timeout"
                                                                class="input input-sm border border-base-300 bg-base-100 rounded-lg font-bold" />
                                                        </div>
                                                    </div>
                                                    <div class="form-control group/prettify relative">
                                                        <label class="label p-0 mb-1"><span
                                                                class="text-[9px] font-bold uppercase tracking-widest opacity-60 text-base-content">Headers</span></label>
                                                        <textarea x-model="resp.response.headers"
                                                            class="textarea border border-base-300 bg-base-100 font-mono text-[10px] h-24 rounded-lg focus:border-primary/30"></textarea>
                                                        <button @click="beautifyConditionalJSON(idx, 'headers')"
                                                            class="absolute top-6 right-2 btn btn-xs btn-ghost gap-1 opacity-0 group-hover/prettify:opacity-100 transition-opacity bg-base-100/80 backdrop-blur-sm border border-base-200 font-bold text-[8px]">PRETTIFY</button>
                                                    </div>
                                                </div>
                                                <div class="form-control group/prettify relative flex-1">
                                                    <label class="label p-0 mb-1"><span
                                                            class="text-[9px] font-bold uppercase tracking-widest opacity-60 text-base-content">Payload</span></label>
                                                    <textarea x-model="resp.response.body"
                                                        class="textarea border border-base-300 bg-base-100 font-mono text-[10px] h-full rounded-lg min-h-[150px] focus:border-primary/30"></textarea>
                                                    <button @click="beautifyConditionalJSON(idx, 'body')"
                                                        class="absolute top-6 right-2 btn btn-xs btn-ghost gap-1 opacity-0 group-hover/prettify:opacity-100 transition-opacity bg-base-100/80 backdrop-blur-sm border border-base-200 font-bold text-[8px]">PRETTIFY</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>